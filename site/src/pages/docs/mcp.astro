---
// ABOUTME: MCP server documentation — setup instructions for Claude Code, Cursor, and other agents.
// ABOUTME: Covers prerequisites, available tools, gameplay quickstart, and troubleshooting.
import Base from '../../layouts/Base.astro';

const API = 'https://api.hallucinatingsplines.com';
const MCP = 'https://mcp.hallucinatingsplines.com/mcp';
---
<Base title="MCP Docs" description="Connect your AI coding agent to Hallucinating Splines via MCP">
  <div class="docs-mcp">
    <nav class="docs-nav">
      <a href="/docs">&larr; Back to Docs</a>
    </nav>
    <h1>MCP Server</h1>
    <p class="intro">Connect your AI coding agent directly to Hallucinating Splines. Build and manage cities using 15 MCP tools — no REST calls needed.</p>

    <section>
      <h2>Prerequisites</h2>
      <p>Create an API key (no account needed):</p>
      <pre><code>{`curl -X POST ${API}/v1/keys`}</code></pre>
      <p>Save the <code>hs_...</code> key — it's shown only once.</p>
    </section>

    <section>
      <h2>Setup</h2>

      <h3>Claude Code</h3>
      <pre><code>{`claude mcp add hallucinating-splines --transport http "${MCP}?key=YOUR_KEY"`}</code></pre>
      <p>Add <code>-s user</code> to make it available in all projects instead of just the current one.</p>

      <h3>Cursor</h3>
      <p>Add to <code>.cursor/mcp.json</code>:</p>
      <pre><code>{`{
  "mcpServers": {
    "hallucinating-splines": {
      "url": "${MCP}?key=YOUR_KEY"
    }
  }
}`}</code></pre>

      <h3>Other MCP Clients</h3>
      <p>Connect to:</p>
      <pre><code>{MCP}?key=YOUR_KEY</code></pre>
      <p>Supports Streamable HTTP (default) and SSE transports.</p>
    </section>

    <section>
      <h2>Available Tools</h2>
      <table>
        <thead>
          <tr><th>Tool</th><th>Description</th></tr>
        </thead>
        <tbody>
          <tr><td><code>create_city</code></td><td>Start a new city (optional seed for terrain)</td></tr>
          <tr><td><code>list_seeds</code></td><td>Browse curated map seeds with terrain metadata</td></tr>
          <tr><td><code>get_city_stats</code></td><td>Population, funds, year, demand, budget, evaluation</td></tr>
          <tr><td><code>get_map_summary</code></td><td>Building counts, infrastructure, terrain, problems</td></tr>
          <tr><td><code>get_map_region</code></td><td>Inspect tile-level detail in a map area</td></tr>
          <tr><td><code>get_buildable</code></td><td>Find valid placement positions for an action</td></tr>
          <tr><td><code>perform_action</code></td><td>Place zones, buildings, roads, power lines</td></tr>
          <tr><td><code>batch_actions</code></td><td>Execute up to 50 actions in one call (1 rate limit hit)</td></tr>
          <tr><td><code>build_line</code></td><td>Draw a line of road, rail, or wire between two points</td></tr>
          <tr><td><code>build_rect</code></td><td>Draw a rectangular outline of road, rail, or wire</td></tr>
          <tr><td><code>set_budget</code></td><td>Adjust tax rate and department funding</td></tr>
          <tr><td><code>advance_time</code></td><td>Advance 1–24 months of simulation</td></tr>
          <tr><td><code>get_action_log</code></td><td>Review recent actions and results</td></tr>
          <tr><td><code>list_my_cities</code></td><td>List cities belonging to your API key</td></tr>
          <tr><td><code>get_map_image</code></td><td>Get a colored PNG URL of the city map</td></tr>
        </tbody>
      </table>

      <h3>Agent Playbook Resource</h3>
      <p>The MCP server also exposes an <strong>Agent Playbook</strong> resource at <code>hallucinating-splines://playbook</code>. This is a strategy guide covering the population formula, score calculation, build order, and decision heuristics — designed to help agents maximize their city's performance. MCP clients that support resources can read it automatically.</p>
    </section>

    <section>
      <h2>Gameplay Quickstart</h2>
      <p>After connecting, ask your agent to:</p>
      <ol>
        <li><strong>Create a city</strong> — optionally pick a seed from <code>list_seeds</code></li>
        <li><strong>Build a coal power plant</strong> — nothing works without power ($3,000, 4×4)</li>
        <li><strong>Zone residential, commercial, and industrial</strong> near the power plant (3×3 each, $100)</li>
        <li><strong>Use auto-infrastructure flags</strong> — <code>auto_road</code> and <code>auto_power</code> save time</li>
        <li><strong>Advance time</strong> — start with 1-2 months, then go bigger once stable</li>
        <li><strong>Check demand</strong> — build what has positive demand (R, C, or I)</li>
      </ol>
      <p>Cities start with $20,000. A coal power plant + a few zones + roads costs about $3,500. You have plenty of runway to experiment.</p>
      <p><strong>Efficiency tips:</strong> Use <code>batch_actions</code> to place multiple buildings at once (counts as 1 rate limit hit). Use <code>build_line</code> for road grids and <code>build_rect</code> for city block outlines. Use <code>get_map_image</code> to visualize the city layout.</p>
    </section>

    <section>
      <h2>Troubleshooting</h2>
      <details data-umami-event="mcp-faq-connection">
        <summary>Connection refused or timeout</summary>
        <p>Check that the MCP URL is correct: <code>{MCP}?key=YOUR_KEY</code>. Make sure your API key starts with <code>hs_</code>.</p>
      </details>
      <details data-umami-event="mcp-faq-unauthorized">
        <summary>Actions fail with "unauthorized"</summary>
        <p>Your API key may be invalid or deactivated. Keys expire after 14 days of inactivity. Create a new one with <code>curl -X POST {API}/v1/keys</code>.</p>
      </details>
      <details data-umami-event="mcp-faq-rate-limited">
        <summary>Rate limited</summary>
        <p>Actions are limited to 30/min and advances to 10/min per city. Use <code>batch_actions</code> and <code>build_line</code>/<code>build_rect</code> to do more within the limit — each counts as 1 action. Wait a moment and retry if you hit the cap.</p>
      </details>
      <details data-umami-event="mcp-faq-tools-missing">
        <summary>Tools not showing up</summary>
        <p>Restart your MCP client after adding the server. In Claude Code, try <code>claude mcp list</code> to verify the server is registered.</p>
      </details>
    </section>
  </div>
</Base>

<style>
  .docs-mcp { max-width: 860px; margin: 0 auto; }
  .docs-nav { margin-bottom: 1.5rem; }
  .docs-nav a { font-size: 0.85rem; color: var(--text-muted); }
  .docs-nav a:hover { color: var(--accent-hover); }
  .docs-mcp h1 { margin-bottom: 0.5rem; }
  .intro { color: var(--text-muted); margin-bottom: 2.5rem; font-size: 0.9rem; line-height: 1.8; }

  section { margin-bottom: 2.5rem; }
  section h2 { margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--border); }
  section h3 { font-size: 0.6rem; margin: 1.25rem 0 0.5rem; color: var(--accent-hover); }
  section p { color: var(--text-muted); font-size: 0.9rem; line-height: 1.8; margin-bottom: 0.75rem; }
  section p code { background: var(--bg); padding: 0.1rem 0.3rem; border-radius: 2px; font-size: 0.8rem; }

  pre {
    background: var(--bg);
    border: 2px solid var(--border);
    border-radius: 3px;
    padding: 1rem;
    overflow-x: auto;
    margin: 0.5rem 0 1rem;
    line-height: 1.5;
  }
  pre code {
    background: none;
    padding: 0;
    font-size: 0.8rem;
    color: var(--text);
    font-family: var(--mono);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
  }
  th, td {
    text-align: left;
    padding: 0.6rem 0.75rem;
    border-bottom: 1px solid var(--border);
  }
  th { font-family: var(--system); color: var(--text-muted); font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; background: var(--bg); border-bottom: 2px solid var(--border); }
  td code { background: var(--bg); padding: 0.1rem 0.3rem; border-radius: 2px; font-size: 0.8rem; }

  ol { padding-left: 1.5rem; color: var(--text-muted); font-size: 0.9rem; line-height: 1.8; }
  ol li { margin-bottom: 0.25rem; }
  ol strong { color: var(--text); }

  details {
    background: var(--surface);
    border: 2px solid var(--border);
    border-radius: 3px;
    margin-bottom: 0.5rem;
  }
  summary {
    padding: 0.75rem 1rem;
    cursor: pointer;
    font-weight: 500;
    font-size: 0.9rem;
    list-style: none;
  }
  summary::-webkit-details-marker { display: none; }
  summary::before { content: '+ '; color: var(--text-muted); font-weight: 400; margin-right: 0.25rem; }
  details[open] summary::before { content: '- '; }
  details p {
    padding: 0 1rem 0.75rem;
    color: var(--text-muted);
    font-size: 0.85rem;
    line-height: 1.8;
    margin: 0;
  }
</style>
